<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">

<title></title>

<meta name="description" content="">    


<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="css/reveal.min.css">
  <link rel="stylesheet" href="css/theme/beige.css" id="theme">


<!-- For syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">


<!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
  document.write( '<link rel="stylesheet" href="css/print/' +
    ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + 
    '.css" type="text/css" media="print">' );
</script>

<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->
</head>

<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

<section>
<h1></h1>

<p>
<h4></h4>
</p>
</section>  


<section id="cabal" class="level7">
<p>Cabal</p>
</section>
<section id="cabal-all-the-things-from-init-to-testing-to-dist" class="level2">
<h2>Cabal All the Things: From Init to Testing to Dist</h2>
<p>Josh Hawkins</p>
<p>April 24, 2013</p>
</section>
<section id="forml-pic" class="level2">
<h2>Forml pic</h2>
</section>
<section id="section" class="level2">
<h2><img src="./img/cabal_start.jpg" /></h2>
</section>
<section id="what-is-cabal" class="level1">
<h1>What is Cabal?</h1>
<section id="a-common-architecture-for-building-applications-and-libraries" class="level3">
<h3>A Common Architecture for Building Applications and Libraries</h3>
<ul>
<li>It describes packages in a common way allowing for distribution, organization, and cataloging.</li>
<li>It describes how packages interact with the language.</li>
<li>It describes what Haskell implementations support packages.</li>
<li>It provides a way to express dependency on particular libraries, compilers, or versions.</li>
</ul>
<hr />
</section>
<section id="what-is-hackagedb" class="level3">
<h3>What is HackageDB?</h3>
<ul>
<li>It is the central repository of open-source Haskell software.</li>
<li>It functions as an upstream distribution system.</li>
<li>It provides a clean web interface for viewing and searching existing libraries.</li>
<li>It provides links to dependencies.</li>
</ul>
<hr />
</section>
<section id="what-is-cabal-install" class="level3">
<h3>What is Cabal-Install?</h3>
<ul>
<li>It's a command line interface for Cabal the Library.</li>
<li>Package management - installing, downloading and dependencies</li>
<li>Package development - configuring, building, testing and benchmarking</li>
<li>Package sharing - packaging and uploading</li>
</ul>
<hr />
</section>
<section id="explore-all-the-packages" class="level2">
<h2>Explore All the Packages</h2>
<section id="some-commands-for-fetching-and-inspecting-libraries." class="level5">
<h5>Some commands for fetching and inspecting libraries.</h5>
<pre><code>* update 
* list
* install
* unpack
* haddock</code></pre>
<hr />
</section>
</section>
<section id="what-does-cabal-update-do" class="level2">
<h2>What does <em>cabal update</em> do?</h2>
<ul>
<li>This will download the most recent list of packages.</li>
<li>Where is it downloading this list from?</li>
</ul>
<hr />
<pre><code>  $ cabal update --verbose=3
  Downloading the latest package list from hackage.haskell.org
  Sending:
  GET /packages/archive/00-index.tar.gz HTTP/1.1
  Host: hackage.haskell.org
  User-Agent: cabal-install/1.16.0.2
  Creating new connection to hackage.haskell.org
  Received:
  HTTP/1.1 200 OK
  Date: Tue, 16 Apr 2013 13:24:07 GMT
  Server: Apache/2.2.9 (Debian) mod_python/3.3.1 Python/2.5.2
  Last-Modified: Tue, 16 Apr 2013 12:15:46 GMT
  ETag: &quot;1888001-59f5ff-4da79543ca080&quot;
  Accept-Ranges: bytes
  Content-Length: 5895679
  Content-Type: application/x-tar
  Content-Encoding: x-gzip
  Downloaded to
  /Users/jhawkins/Library/Haskell/repo-cache/hackage.haskell.org/00-index.tar.gz
  Updating the index cache file...
  Reading available packages...</code></pre>
<hr />
<section id="cabal-lets-you-know..." class="level3">
<h3>Cabal lets you know...</h3>
<section id="when-your-packages-need-an-update." class="level4">
<h4>when your packages need an update.</h4>
<pre><code>Warning: The package list for &#39;hackage.haskell.org&#39; is 17 days old.
Run &#39;cabal update&#39; to get the latest list of available packages.</code></pre>
</section>
<section id="when-your-cabal-install-needs-an-update." class="level4">
<h4>when your cabal-install needs an update.</h4>
<pre><code>Note: there is a new version of cabal-install available.
            To upgrade, run: cabal install cabal-install</code></pre>
<hr />
</section>
</section>
</section>
<section id="lets-try-out-cabal-list." class="level2">
<h2>Lets try out <em>cabal list</em>.</h2>
<pre><code>  $ cabal list snaplet-tasks
  * snaplet-tasks
      Synopsis: Snaplet for Snap Framework enabling developers to administrative
                tasks akin to Rake tasks from Ruby On Rails framework.
      Default available version: 0.1.2
      Installed versions: [ Not installed ]
      License:  BSD3
  Top level overview of the package available</code></pre>
<hr />
<section id="what-does-cabal-install-do" class="level3">
<h3>What does <em>cabal install</em> do?</h3>
<ul>
<li>Resolving dependencies...</li>
<li>Grabs the Library's Dependencies.</li>
<li>Grabs the Library you specified.</li>
<li>Build, compiles, installs, registers, generates docs...</li>
</ul>
<hr />
<pre><code>$ cabal install snap
Resolving dependencies...
Downloading MonadCatchIO-transformers-0.3.0.0...
Configuring MonadCatchIO-transformers-0.3.0.0...
Building MonadCatchIO-transformers-0.3.0.0...
Preprocessing library MonadCatchIO-transformers-0.3.0.0...
[1 of 1] Compiling Control.Monad.CatchIO ( src/Control/Monad/CatchIO.hs, dist/build/Control/Monad/CatchIO.o )</code></pre>
<hr />
<pre><code>Documentation created: dist/doc/html/snap/index.html
Installing library in
/Users/jhawkins/Library/Haskell/ghc-7.4.2/lib/snap-0.11.2.2/lib
Installing executable(s) in
/Users/jhawkins/Library/Haskell/ghc-7.4.2/lib/snap-0.11.2.2/bin
Registering snap-0.11.2.2...
Installed snap-0.11.2.2
Updating documentation index /Users/jhawkins/Library/Haskell/doc/index.html</code></pre>
<hr />
<section id="if-you-really-want-to-know-what-a-package-is-doing" class="level5">
<h5>If you really want to know what a package is doing,</h5>
</section>
</section>
<section id="cabal-unpack" class="level3">
<h3><em>cabal unpack</em></h3>
<ul>
<li>This simply Downloads the package from Hackage</li>
<li>Creates a versioned directory</li>
<li>And drops the source code right there.</li>
</ul>
<hr />
<pre><code>$ cabal unpack snap --verbose=3
Reading available packages...
snap-0.11.2.2 has already been downloaded.
Unpacking to snap-0.11.2.2/
Updating snap-0.11.2.2/snap.cabal with the latest revision from the index.</code></pre>
<hr />
</section>
<section id="generate-some-documentation-via-cabal-haddock" class="level3">
<h3>Generate Some Documentation via <em>cabal haddock</em></h3>
<ul>
<li>Generates some nicely formatted html.</li>
<li>Documentation created: dist/doc/html/fizzbuzz/fizzbuzz/index.html</li>
<li>This is another option when exploring the api of a library found on hackage.</li>
</ul>
<hr />
</section>
<section id="develop-all-the-packages" class="level3">
<h3>Develop All the Packages</h3>
<pre><code>* init
* configure
* build
* test
* bench
* sdist
* upload</code></pre>
<hr />
</section>
<section id="what-does-cabal-init-do" class="level3">
<h3>What does <em>cabal init</em> do?</h3>
<ul>
<li>An interactive command that aids in the generation of a .cabal file.</li>
<li><p>Coaches you through the pains of getting a simple .cabal file filled out the first time.</p>
<ul>
<li>Guesses at obvious descriptors - name, version, author, maintainer...</li>
<li>Gives some common options for the necessary fields</li>
<li>Generates a template LICENSE for you.</li>
<li>Adds a specified Section - Library or Executable</li>
<li>Adds descriptions and TODOs to the .cabal file</li>
</ul></li>
</ul>
<hr />
<figure>
<img src="./img/cabal_init.png" />
</figure>
<hr />
</section>
<section id="cabal-all-the-fields" class="level3">
<h3>.cabal All the Fields</h3>
<p>Defined in the PackageDescription module of cabal</p>
<pre><code>* Provides a declarative description of your package.
* Contains a top level description for use by Hackage.
* Contains Build Information.
* Contains Flags
* Contains a few Sections with build information.
    Library
    Executable
    TestSuite
    Benchmark</code></pre>
<hr />
</section>
<section id="top-level-description" class="level3">
<h3>Top Level Description</h3>
<p>A place for all the metadata about the package for use by Hackage.</p>
<pre><code>name:               enterpriseFizzBuzz

-- elaborate on the importance of version
version:            1.15.3.1
synopsis:           The command-line interface for FizzBuzzing up to a number!
description:        A very complex tool for taking a number from the command line and printing a formatted string that replaces numbers divisible by 3 with &#39;Fizz&#39;, numbers divisible by 5 with &#39;Buzz&#39; and numbers divisible by 3 and 5 with &#39;FizzBuzz&#39;.
homepage:           http://www.haskell.org/enterpriseFizzBuzz/
bug-reports:        https://github.com/JHawk/enterpriseFizzBuzz/issues
license:            BSD3
license-file:       LICENSE
author:             JHawk &lt;jhawk@fizzbuzzEnterprises.com&gt;
maintainer:         jhawk@fizzBuzzEnterprises.com
copyright:          2013 JHawk &lt;jhawk@fizzbuzzEnterprises.com&gt;
category:           Text
tested-with:        GHC == 7.0.2

source-repository head
  type:     git
  location: https://github.com/JHawk/enterpriseFizzBuzz/
  subdir:   FizzBuzzLib</code></pre>
<hr />
</section>
<section id="build-description" class="level3">
<h3>Build Description</h3>
<pre><code>build-type:         Simple 
cabal-version:      &gt;=1.8

-- defines other files to be packaged and distributed
extra-source-files: README bootstrap.sh
    </code></pre>
<hr />
</section>
<section id="a-few-common-package-build-fields" class="level3">
<h3>A Few Common Package Build Fields</h3>
<p>Some have subfields.</p>
<pre><code>build-depends:
  -- prelude +
  base &gt;= 2,
  buzz,
  -- symantic versioning 
  fizz &gt;= 1.2 &amp;&amp; &lt; 1.3
  -- fizz ==1.2.*
  
-- private : package level visibility
-- compile but don&#39;t export
other-modules:  
    EnterpriseFizzBuzz.FizzBuzz</code></pre>
<p>Some specify specific variables.</p>
<pre><code>buildable: false
hs-source-dirs: src/FizzBuzz</code></pre>
<p>Some set flags or tokens.</p>
<pre><code>ghc-options: -Wall -fwarn-tabs -threaded
extensions: CPP, ForeignFunctionInterface // TODO</code></pre>
<hr />
</section>
<section id="conditional-thingy" class="level3">
<h3>Conditional Thingy</h3>
<pre><code>if impl(ghc &lt;= 7.4.2)
  build-depends:
    bytestring &gt;= 0.9.1 &amp;&amp; &lt;0.10
else
  build-depends:
    bytestring &gt;= 0.10.0 &amp;&amp; &lt;0.11</code></pre>
<hr />
</section>
<section id="define-your-own-flag-thingy" class="level3">
<h3>Define Your Own Flag Thingy</h3>
<pre><code>flag benchmarks
  description: Build the benchmarks
  default: False

if flag(benchmarks)
  buildable: True
  build-depends: criterion
else
  buildable: False        </code></pre>
<hr />
<figure>
<img src="./img/screenshot.jpg" alt="Alt text" /><figcaption>Alt text</figcaption>
</figure>
<hr />
</section>
<section id="use-it-via-cabal-configure" class="level3">
<h3>Use it via <em>cabal configure</em></h3>
<pre><code>$ cabal configure --flags=benchmarks</code></pre>
<hr />
</section>
<section id="library-section" class="level3">
<h3>Library Section</h3>
<section id="requires-exposed-modules" class="level5">
<h5>Requires exposed-modules</h5>
<ul>
<li>All modules are either exposed-modules or other-modules.</li>
<li>Contains fields and subsections for describing how to build the library.</li>
</ul>
<hr />
<pre><code>library
  build-depends:
    base         &gt;= 4 &amp;&amp; &lt;= 5 
  
  other-modules:
    EnterpriseFizzBuzz.HiddenStuff
  
  exposed-modules:  
      EnterpriseFizzBuzz.Fizz
    , EnterpriseFizzBuzz.Buzz
    , EnterpriseFizzBuzz.FizzBuzz</code></pre>
<hr />
</section>
</section>
<section id="executable-section" class="level3">
<h3>Executable Section</h3>
<section id="main-is-is-the-main-difference." class="level5">
<h5>Main-Is is the main difference.</h5>
</section>
<section id="requires-main-is-unique-identifier" class="level5">
<h5>Requires Main-Is, Unique Identifier</h5>
<hr />
<pre><code>executable enterpriseFizzBuzz
  ghc-options: -Wall -threaded
  if impl(ghc &gt;= 6.8)
    ghc-options: -fwarn-tabs
  
  other-modules:
    Command.ParseNumber
    
  build-depends: 
      base     &gt;= 4 &amp;&amp; &lt;= 5 
    , network  &gt;= 1 &amp;&amp; &lt; 3
    , fizzBuzz

  hs-source-dirs: src/
  main-is:        Main.hs

  -- alternatively 
  -- main-is:     src/Main.hs</code></pre>
<hr />
</section>
</section>
<section id="test-suite-section" class="level3">
<h3>Test-Suite Section</h3>
<section id="requires-unique-identifier-main-is-type" class="level5">
<h5>Requires Unique Identifier, Main-Is, Type</h5>
<ul>
<li>Describes executables that indicate failure with a non-zero exit code.</li>
<li>more description</li>
</ul>
<hr />
<pre><code>test-suite fizzbuzz-tests
  hs-source-dirs: tests
  build-depends:
      base
    , test-framework
    , test-framework-hunit
    , test-framework-quickcheck2
    , HUnit
    , QuickCheck
    , enterpriseFizzBuzz

  main-is: UnitTests.hs

  type: exitcode-stdio-1.0</code></pre>
<hr />
</section>
</section>
<section id="benchmark-section" class="level3">
<h3>Benchmark Section</h3>
<section id="requires-unique-identifier-main-is-type-1" class="level5">
<h5>Requires Unique Identifier, Main-Is, Type</h5>
<ul>
<li>Describes executables that indicate failure with a non-zero exit code.</li>
<li>more description</li>
</ul>
<hr />
<pre><code>benchmark fizzbuzz-benchmarker
  type:             exitcode-stdio-1.0
  main-is:          FizzBuzzBench.hs
  build-depends:    base
                  , criterion</code></pre>
<hr />
</section>
</section>
<section id="look-at-a-complete-.cabal-file." class="level3">
<h3>Look at a Complete .cabal File.</h3>
<hr />
</section>
<section id="srcmain.hs" class="level3">
<h3>src/Main.hs</h3>
<pre><code>screenshot</code></pre>
<hr />
</section>
<section id="srcenterprisefizzbuzz.hs" class="level3">
<h3>src/Enterprise/FizzBuzz.hs</h3>
<pre><code>screenshot</code></pre>
<hr />
</section>
<section id="what-does-cabal-configure-do" class="level3">
<h3>What does <em>cabal configure</em> do?</h3>
<ul>
<li>Prepares to build the package.</li>
<li>Looks for available packages -&gt; Reading available packages...</li>
<li>Tries to resolve dependecies -&gt; Resolving dependencies...</li>
<li>Decides which tools to use -&gt; Using tar found on system at : /usr/bin/tar</li>
<li>At least the following dependencies are missing: GraphSCC ==1.0.3, HStringTemplate ==0.6.12, …</li>
</ul>
<hr />
<section id="what-does-cabal-build-do" class="level4">
<h4>What does <em>cabal build</em> do?</h4>
<ul>
<li>Runs cabal configure with most recently used options.</li>
<li>Creates dist/build</li>
<li>Builds the package and puts it in dist/build/enterpriseFizzBuzz/enterpriseFizzBuzz</li>
</ul>
<hr />
</section>
</section>
<section id="what-happens-when-i-run-it" class="level3">
<h3>What happens when I run it?</h3>
<pre><code>$ cabal configure &amp;&amp; cabal build
$ ./dist/build/enterpriseFizzBuzz/enterpriseFizzBuzz
How many numbers should I FizzBuzz.
4
enterpriseFizzBuzz: Prelude.undefined</code></pre>
<hr />
<section id="how-do-i-go-about-testing-my-code" class="level4">
<h4>How do I go about testing my code?</h4>
</section>
</section>
<section id="test-framework" class="level3">
<h3>test-framework</h3>
<ul>
<li>Test in parallel</li>
<li>Report in deterministic order</li>
<li>Supports Unit as well as Invariant tests</li>
</ul>
<p>**** may remove</p>
<ul>
<li>Add your own test providers above and beyond those provided.</li>
<li>Reports failing seeds for QuickCheck</li>
</ul>
<hr />
</section>
<section id="hunit" class="level3">
<h3>HUnit</h3>
<ul>
<li>HUnit is an adaptation of JUnit</li>
<li>Use test-framework-hunit provider</li>
<li>More description</li>
</ul>
<hr />
</section>
<section id="test-suiteunitenterprisetests.hs" class="level3">
<h3>test-suite/unit/Enterprise/Tests.hs</h3>
<pre><code>screenshot</code></pre>
<hr />
</section>
<section id="run-it-with-cabal-test" class="level3">
<h3>Run it with <em>cabal test</em>!</h3>
<pre><code>$ cabal configure --enable-tests &amp;&amp; cabal build &amp;&amp; cabal test
$ cabal configure --disable-tests &amp;&amp; cabal build</code></pre>
<ul>
<li>do the test-suite deps get added to the build if not enabled?</li>
</ul>
<hr />
</section>
<section id="quickcheck-if-i-have-time" class="level3">
<h3>QuickCheck if i have time</h3>
<ul>
<li>blah</li>
<li>blah</li>
<li>blah</li>
</ul>
<hr />
</section>
<section id="how-can-i-run-my-benchmarks" class="level3">
<h3>How can I run my benchmarks?</h3>
<pre><code>$ cabal configure --enable-benchmarks &amp;&amp; cabal build &amp;&amp; cabal bench
$ cabal configure --disable-benchmarks &amp;&amp; cabal build</code></pre>
<hr />
</section>
<section id="enjoying-the-nice-html-output." class="level3">
<h3>Enjoying the nice html output.</h3>
<pre><code> $ ./dist/build/enterpriseBench/enterpriseBench -o enterpriseBench.html</code></pre>
<hr />
</section>
<section id="how-do-i-get-this-code-out-the-door" class="level3">
<h3>How do I get this code out the door?</h3>
<section id="cabal-sdist" class="level4">
<h4><em>cabal sdist</em></h4>
<ul>
<li>Building source dist for fizzbuzz-0.1.0.0...</li>
<li>Preprocessing executable 'fizzbuzz' for fizzbuzz-0.1.0.0...</li>
<li>Source tarball created: dist/fizzbuzz-0.1.0.0.tar.gz</li>
</ul>
<hr />
</section>
<section id="for-those-who-want-to-give-back" class="level4">
<h4>For those who want to give back,</h4>
</section>
</section>
<section id="cabal-upload" class="level3">
<h3><em>cabal upload</em></h3>
<ul>
<li>Requires a Hackage username and password.</li>
<li>Uploads your package to Hackage.</li>
</ul>
<hr />
</section>
<section id="for-more-information" class="level3">
<h3>For More Information</h3>
<pre><code>$ cabal unpack cabal &amp;&amp; cd Cabal-1.16.*** &amp;&amp; cabal configure &amp;&amp; cabal haddock</code></pre>
<hr />
<figure>
<img src="./img/cabal_end.jpg" />
</figure>
<hr />
<hr />
<p>.</p>
<hr />
<p>“Languages flourish when libraries are plentiful, reliable, and well documented.” - Simon Peyton Jones</p>
</section>
<section id="extending-cabal" class="level3">
<h3>Extending Cabal</h3>
</section>
<section id="a-more-custom-build" class="level3">
<h3>A more Custom Build</h3>
<ul>
<li>Uses Setup.hs or Setup.lhs.</li>
<li>TODO - Custom build and setup.hs</li>
<li>look at darcs ### Define your own task API?</li>
</ul>
<hr />
</section>
<section id="quickcheck-if-i-have-time-1" class="level3">
<h3>QuickCheck if i have time</h3>
<ul>
<li>blah</li>
<li>blah</li>
<li>blah</li>
</ul>
<hr />
</section>
<section id="detailed-may-not-be-available-yet" class="level3">
<h3>detailed (may not be available yet)</h3>
<ul>
<li>Preferred method for writing tests.</li>
<li>Produces more detailed human and machine readable results.</li>
<li>Requires a test-module field : The module exporting the tests.</li>
</ul>
<p>example</p>
<pre><code>test-suite detailed-fizzbuzz-tests
    build-depends: 
      base,
      test-framework,
      test-framework-hunit,
      test-framework-quickcheck2,
      HUnit,
      QuickCheck
    
    type:       detailed-1.0
    
    test-module: FizzBuzz.Tests</code></pre>
<hr />
</section>
</section>
</section>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>
  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: false,

  // available themes are in /css/theme
      theme: Reveal.getQueryHash().theme || 'beige', 
  
  // default/cube/page/concave/zoom/linear/fade/none
      transition: Reveal.getQueryHash().transition || 'linear',
  
  // Optional libraries used to extend on reveal.js
  dependencies: [
    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
    { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
  });

</script>

</body>
</html>
